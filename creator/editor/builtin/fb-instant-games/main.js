const e=require("fire-fs"),i=require("fire-path"),r=(require("gulp").Gulp,require("gulp-util"),require("async")),t=(require("event-stream"),require(Editor.url("app://editor/core/gulp-build.js")),require("./lib/jszip.min.js")),n=require("electron"),l="fb-instant-games";function o(o,u){if(o.platform!==l)return u();let s=new t;(function t(n,l,o){let u=e.readdirSync(n),s=0;if(s===u.length)return o();r.whilst(function(){return s<u.length},function(r){let o=u[s],d=i.join(n,o);e.lstatSync(d).isDirectory()?t(d,l.folder(o),()=>{s++,r()}):(l.file(o,e.readFileSync(d)),s++,r())},function(){o()})})(o.dest,s,()=>{let r=i.join(o.dest,o.title);s.generateNodeStream({type:"nodebuffer",compression:"DEFLATE",compressionOptions:{level:9}}).pipe(e.createWriteStream(r+".zip")).on("finish",()=>{Editor.isWin32||(r=i.dirname(r)),n.shell.showItemInFolder(r),u()})})}module.exports={load(){Editor.Builder.on("build-finished",o)},unload(){Editor.Builder.removeListener("build-finished",o)},messages:{}};